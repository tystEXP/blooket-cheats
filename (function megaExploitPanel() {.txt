(function megaExploitPanel() {
  if (document.getElementById('mega-exploit-panel')) return;

  // === NOTIFICATION SYSTEM ===
  const notifContainer = document.createElement('div');
  notifContainer.style.cssText = `
    position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
    z-index: 9999999; pointer-events: none; width: 100%; max-width: 420px;
  `;
  document.body.appendChild(notifContainer);

  let baseTop = 20;
  const overlapOffset = 20;

  function showNotification(message, isSuccess = true) {
    const notif = document.createElement('div');
    const currentTop = baseTop;
    baseTop += overlapOffset;

    notif.style.cssText = `
      position: absolute; top: ${currentTop}px; left: 50%; transform: translateX(-50%);
      padding: 18px 32px; border-radius: 22px; font-weight: bold;
      color: white; font-size: 16px; text-align: center;
      font-family: "Nunito", sans-serif; min-width: 280px; max-width: 380px;
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      background: ${isSuccess ? 'rgba(40, 167, 69, 0.32)' : 'rgba(220, 53, 69, 0.32)'};
      border: 1.5px solid ${isSuccess ? 'rgba(40, 167, 69, 0.6)' : 'rgba(220, 53, 69, 0.6)'};
      box-shadow: 0 14px 40px rgba(0,0,0,0.3), 0 0 30px ${isSuccess ? 'rgba(40, 167, 69, 0.4)' : 'rgba(220, 53, 69, 0.4)'};
      transform: translateX(-50%) translateY(-120px); opacity: 0;
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: ${9999999 + baseTop};
    `;
    notif.textContent = message;
    notifContainer.appendChild(notif);

    requestAnimationFrame(() => {
      notif.style.transform = 'translateX(-50%) translateY(0)';
      notif.style.opacity = '1';
    });

    setTimeout(() => {
      notif.style.transform = 'translateX(-50%) translateY(-140px)';
      notif.style.opacity = '0';
      setTimeout(() => {
        if (notif.parentNode) notifContainer.removeChild(notif);
        baseTop = Math.max(20, baseTop - overlapOffset);
      }, 500);
    }, 3000);
  }

  showNotification('Initializing MEGA EXPLOIT PANEL...', false);

  // === CONFETTI ON MAX ===
  function triggerConfetti() {
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.style.cssText = `position:fixed;top:0;left:0;width:100vw;height:100vh;pointer-events:none;z-index:9999998;`;
    document.body.appendChild(canvas);

    function resize() { canvas.width = innerWidth; canvas.height = innerHeight; }
    resize();
    window.addEventListener('resize', resize);

    const colors = ['#FFD700', '#FFA500', '#FF8C00', '#00E676', '#00C853', '#00E5FF', '#7C4DFF', '#FF4081'];
    const particles = [];
    for (let i = 0; i < 200; i++) {
      particles.push({
        x: innerWidth / 2 + (Math.random() - 0.5) * 200,
        y: innerHeight / 2 + (Math.random() - 0.5) * 100,
        r: Math.random() * 5 + 3,
        color: colors[Math.floor(Math.random() * colors.length)],
        vx: (Math.random() - 0.5) * 18,
        vy: Math.random() * -15 - 5,
        rotation: Math.random() * 360,
        rotationSpeed: Math.random() * 10 - 5,
        life: 100
      });
    }

    let id;
    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach((p, i) => {
        p.vy += 0.4; p.x += p.vx; p.y += p.vy; p.rotation += p.rotationSpeed; p.life--;
        if (p.life <= 0 || p.y > canvas.height + 50) { particles.splice(i, 1); return; }
        ctx.save(); ctx.translate(p.x, p.y); ctx.rotate(p.rotation * Math.PI / 180);
        ctx.fillStyle = p.color; ctx.fillRect(-p.r, -p.r, p.r * 2, p.r * 2); ctx.restore();
      });
      if (particles.length > 0) id = requestAnimationFrame(animate);
      else { cancelAnimationFrame(id); canvas.remove(); window.removeEventListener('resize', resize); }
    }
    animate();
  }

  // === PANEL ===
  const panel = document.createElement('div');
  panel.id = 'mega-exploit-panel';
  panel.style.cssText = `
    position: fixed; top: 20px; left: 20px; z-index: 999999;
    width: 340px; padding: 16px; border-radius: 16px;
    background: rgba(255,255,255,0.25); backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.3);
    box-shadow: 0 10px 25px rgba(0,0,0,0.25);
    font-family: "Nunito", sans-serif; color: #111;
    user-select: none; cursor: grab; max-height: 90vh; overflow-y: auto;
  `;

  panel.innerHTML = `
    <style>
      @keyframes rainbowShimmer {
        0%   { background-position: 0% 50%; }
        50%  { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      .rainbow-btn {
        background: linear-gradient(90deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
        background-size: 300% 300%;
        animation: rainbowShimmer 3s ease infinite;
        color: white !important; font-weight: bold; border-radius: 12px;
        padding: 10px; width: 100%; cursor: pointer; font-size: 14px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1.5px solid rgba(255,255,255,0.4);
        backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
        text-shadow: 0 1px 3px rgba(0,0,0,0.5); transition: transform 0.2s ease;
      }
      .rainbow-btn:hover { transform: scale(1.05); }

      .tab-btn { padding: 8px 16px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 13px; transition: all 0.2s; }
      .tab-btn.active { background: #0078ff; color: white; }
      .tab-btn:not(.active) { background: rgba(0,0,0,0.1); }
      .tab-content { display: none; margin-top: 12px; }
      .tab-content.active { display: block; }
      .quick-btn { padding: 8px 12px; font-weight: bold; border: none; border-radius: 12px; color: white; cursor: pointer; font-size: 14px; transition: transform 0.2s ease; margin: 4px 2px; }
      .quick-btn:hover { transform: scale(1.05); }
      .btn-container { display: flex; flex-wrap: wrap; gap: 6px; justify-content: space-between; margin-top: 6px; }
      .input-group { display: flex; gap: 6px; }
      .input-group input { flex: 1; padding: 6px 8px; border-radius: 12px; border: 1px solid rgba(0,0,0,0.2); background: rgba(255,255,255,0.8); font-size: 13px; outline: none; }
      .local-counter { color: white !important; font-weight: bold; font-size: 13px; }

      /* PERFECT CLOSE BUTTON */
      #panel-close {
        position: absolute; top: 8px; right: 8px;
        width: 36px; height: 36px;
        border: none; background: rgba(255,255,255,0.3);
        border-radius: 50%; cursor: pointer;
        font-size: 18px; font-weight: bold; color: #fff;
        display: flex; align-items: center; justify-content: center;
        backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        transition: all 0.2s ease;
        opacity: 0.8;
      }
      #panel-close:hover {
        background: rgba(220, 53, 69, 0.7) !important;
        transform: scale(1.1);
        opacity: 1 !important;
      }
    </style>

    <div style="position: relative;">
      <strong style="font-size: 16px; display: block; text-align: center; padding-right: 40px;">MEGA EXPLOIT PANEL v9+++++</strong>
      <button id="panel-close">×</button>
    </div>

    <div style="display: flex; gap: 6px; margin-top: 10px;">
      <button class="tab-btn active" data-tab="gold">GOLD</button>
      <button class="tab-btn" data-tab="crypto">CRYPTO</button>
    </div>

    <div id="tab-gold" class="tab-content active">
      <div style="margin-top: 10px;">
        <label style="font-size: 14px;">Set Gold Value:</label>
        <div class="input-group">
          <input type="text" placeholder="INPUT VALUE..." id="gold-input">
          <button id="gold-set" class="quick-btn" style="background: #0078ff;">Set</button>
        </div>
      </div>
      <p style="margin-top: 12px; font-size: 13px;">Exploited Gold: <span id="gold-value" style="font-weight: bold;">none</span></p>
      <button id="gold-add-btn" class="quick-btn" style="background: #28a745; width: 100%; margin-top: 12px;">ADD GOLD</button>
      <div class="btn-container">
        <button class="quick-btn" data-gold-add="5" style="background: #FFD700;">+5</button>
        <button class="quick-btn" data-gold-add="10" style="background: #FFD700;">+10</button>
        <button class="quick-btn" data-gold-add="20" style="background: #FFD700;">+20</button>
        <button class="quick-btn" data-gold-mult="2" style="background: #FFD700;">×2</button>
        <button class="quick-btn" data-gold-mult="3" style="background: #FFD700;">×3</button>
        <button class="quick-btn" data-gold-mult="0" style="background: #FF4C4C;">Reset</button>
        <span id="local-counter" class="local-counter">Local Gold: 0</span>
      </div>
      <button id="max-gold-btn" class="rainbow-btn" style="margin-top: 8px;">MAX GOLD</button>
    </div>

    <div id="tab-crypto" class="tab-content">
      <div style="margin-top: 10px;">
        <label style="font-size: 14px;">Set Crypto Value:</label>
        <div class="input-group">
          <input type="text" placeholder="INPUT VALUE..." id="crypto-input">
          <button id="crypto-set" class="quick-btn" style="background: #0078ff;">Set</button>
        </div>
      </div>
      <p style="margin-top: 12px; font-size: 13px;">Current Crypto: <span id="crypto-value" style="font-weight: bold;">none</span></p>
      <button id="crypto-add-btn" class="quick-btn" style="background: #28a745; width: 100%; margin-top: 12px;">ADD CRYPTO</button>
      <div class="btn-container">
        <button class="quick-btn" data-crypto-add="5" style="background: #00E676;">+5</button>
        <button class="quick-btn" data-crypto-add="10" style="background: #00E676;">+10</button>
        <button class="quick-btn" data-crypto-add="20" style="background: #00E676;">+20</button>
        <button class="quick-btn" data-crypto-mult="2" style="background: #00E676;">×2</button>
        <button class="quick-btn" data-crypto-mult="3" style="background: #00E676;">×3</button>
        <button class="quick-btn" data-crypto-mult="0" style="background: #FF4C4C;">Reset</button>
        <!-- LOCAL CRYPTO REMOVED -->
      </div>
      <button id="max-crypto-btn" class="rainbow-btn" style="margin-top: 8px;">MAX CRYPTO</button>
    </div>
  `;

  document.body.appendChild(panel);

  // === ELEMENTS ===
  const closeBtn = panel.querySelector('#panel-close');
  const tabBtns = panel.querySelectorAll('.tab-btn');
  const tabs = panel.querySelectorAll('.tab-content');
  const goldInput = panel.querySelector('#gold-input');
  const goldSetBtn = panel.querySelector('#gold-set');
  const goldValueEl = panel.querySelector('#gold-value');
  const goldAddBtn = panel.querySelector('#gold-add-btn');
  const maxGoldBtn = panel.querySelector('#max-gold-btn');
  const cryptoInput = panel.querySelector('#crypto-input');
  const cryptoSetBtn = panel.querySelector('#crypto-set');
  const cryptoValueEl = panel.querySelector('#crypto-value');
  const cryptoAddBtn = panel.querySelector('#crypto-add-btn');
  const maxCryptoBtn = panel.querySelector('#max-crypto-btn');
  const localCounter = panel.querySelector('#local-counter'); // Only shows for Gold

  // === PERSISTENCE & REACT ===
  let storedGold = localStorage.getItem('exploitValue') || null;
  let storedCrypto = localStorage.getItem('cryptoExploitValue') || null;
  if (storedGold) goldValueEl.textContent = Number(storedGold).toLocaleString();
  if (storedCrypto) cryptoValueEl.textContent = Number(storedCrypto).toLocaleString();

  function getReactHandler() {
    try {
      const root = document.querySelector('#app > div > div');
      if (!root) return null;
      const vals = Object.values(root);
      return (vals[1]?.children?.[1]) ? vals[1].children[1]._owner : null;
    } catch { return null; }
  }

  function updateState(key, value) {
    const handler = getReactHandler();
    if (!handler?.stateNode?.setState) {
      showNotification('React state not found!', false);
      return false;
    }
    const stateUpdate = {};
    stateUpdate[key] = value;
    stateUpdate[key + '2'] = value;
    handler.stateNode.setState(stateUpdate);
    return true;
  }

  function getCurrent(key) {
    const handler = getReactHandler();
    return handler?.stateNode?.state?.[key] || 0;
  }

  // === LOCAL COUNTER – GOLD ONLY ===
  function updateLocalCounter() {
    setTimeout(() => {
      const activeTab = document.querySelector('.tab-btn.active')?.dataset.tab;
      if (activeTab !== 'gold') return; // Only update for Gold
      const value = getCurrent('gold');
      localCounter.textContent = `Local Gold: ${Number(value).toLocaleString()}`;
    }, 0);
  }

  setInterval(updateLocalCounter, 500);

  function modifyValue(key, amount, multiply = false) {
    const current = Number(getCurrent(key)) || 0;
    const newVal = multiply ? current * amount : current + amount;
    if (updateState(key, newVal)) {
      if (key === 'gold') updateLocalCounter();
      const action = multiply ? `×${amount}` : `+${amount}`;
      showNotification(`Successfully altered ${key} ${action}!`, true);
    } else {
      showNotification(`Failed to modify ${key}`, false);
    }
  }

  // === TAB SWITCHING ===
  tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      tabBtns.forEach(b => b.classList.remove('active'));
      tabs.forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
      if (btn.dataset.tab === 'gold') updateLocalCounter();
    });
  });

  // === INPUT SETUP ===
  function setupInput(input, btn, saveFn) {
    btn.addEventListener('click', () => {
      const v = input.value.trim();
      if (!v) return;
      const num = parseFloat(v);
      if (!isFinite(num) || num <= 0) return showNotification('Invalid number!', false);
      saveFn(num);
    });
    input.addEventListener('keydown', e => { if (e.key === 'Enter') btn.click(); });
  }

  // === GOLD LOGIC ===
  function saveGold(v) {
    storedGold = v;
    localStorage.setItem('exploitValue', v);
    goldValueEl.textContent = Number(v).toLocaleString();
    goldInput.value = '';
    showNotification('Gold value saved!', true);
  }
  setupInput(goldInput, goldSetBtn, saveGold);
  goldAddBtn.addEventListener('click', () => {
    if (!storedGold) return showNotification('Set gold first!', false);
    modifyValue('gold', Number(storedGold), false);
  });

  panel.querySelectorAll('[data-gold-add]').forEach(btn => {
    btn.addEventListener('click', () => modifyValue('gold', Number(btn.dataset.goldAdd), false));
  });

  panel.querySelectorAll('[data-gold-mult]').forEach(btn => {
    const mult = Number(btn.dataset.goldMult);
    if (mult === 0) {
      btn.addEventListener('click', () => {
        if (updateState('gold', 0)) {
          updateLocalCounter();
          showNotification('Successfully reset Gold!', true);
        } else {
          showNotification('Failed to reset Gold', false);
        }
      });
    } else {
      btn.addEventListener('click', () => modifyValue('gold', mult, true));
    }
  });

  maxGoldBtn.addEventListener('click', () => {
    if (updateState('gold', 1.79e308)) {
      updateLocalCounter();
      showNotification('MAX GOLD ACHIEVED!', true);
      triggerConfetti();
    }
  });

  // === CRYPTO LOGIC (NO LOCAL COUNTER) ===
  function saveCrypto(v) {
    storedCrypto = v;
    localStorage.setItem('cryptoExploitValue', v);
    cryptoValueEl.textContent = Number(v).toLocaleString();
    cryptoInput.value = '';
    showNotification('Crypto value saved!', true);
  }
  setupInput(cryptoInput, cryptoSetBtn, saveCrypto);
  cryptoAddBtn.addEventListener('click', () => {
    if (!storedCrypto) return showNotification('Set crypto first!', false);
    modifyValue('crypto', Number(storedCrypto), false);
  });

  panel.querySelectorAll('[data-crypto-add]').forEach(btn => {
    btn.addEventListener('click', () => modifyValue('crypto', Number(btn.dataset.cryptoAdd), false));
  });

  panel.querySelectorAll('[data-crypto-mult]').forEach(btn => {
    const mult = Number(btn.dataset.cryptoMult);
    if (mult === 0) {
      btn.addEventListener('click', () => {
        if (updateState('crypto', 0)) {
          showNotification('Successfully reset Crypto!', true);
        } else {
          showNotification('Failed to reset Crypto', false);
        }
      });
    } else {
      btn.addEventListener('click', () => modifyValue('crypto', mult, true));
    }
  });

  maxCryptoBtn.addEventListener('click', () => {
    if (updateState('crypto', 1.79e308)) {
      showNotification('MAX CRYPTO ACHIEVED!', true);
      triggerConfetti();
    }
  });

  // === INITIALIZE ===
  updateLocalCounter();

  // === CLOSE & DRAG ===
  closeBtn.addEventListener('click', () => {
    panel.remove();
    notifContainer.remove();
  });

  let isDragging = false, startX = 0, startY = 0, origX = 0, origY = 0;
  const clamp = (v, min, max) => Math.min(Math.max(v, min), max);

  panel.addEventListener('mousedown', e => {
    if (['INPUT', 'BUTTON'].includes(e.target.tagName)) return;
    isDragging = true;
    startX = e.clientX; startY = e.clientY;
    origX = panel.offsetLeft; origY = panel.offsetTop;
    panel.style.cursor = 'grabbing';
  });

  document.addEventListener('mousemove', e => {
    if (!isDragging) return;
    const dx = e.clientX - startX, dy = e.clientY - startY;
    const maxL = window.innerWidth - panel.offsetWidth - 8;
    const maxT = window.innerHeight - panel.offsetHeight - 8;
    panel.style.left = clamp(origX + dx, 8, maxL) + 'px';
    panel.style.top = clamp(origY + dy, 8, maxT) + 'px';
  });

  document.addEventListener('mouseup', () => {
    isDragging = false;
    panel.style.cursor = 'grab';
  });

  // === HOTKEY ===
  window.addEventListener('keydown', e => {
    if (e.shiftKey && e.key.toLowerCase() === 's' && !document.getElementById('mega-exploit-panel')) {
      megaExploitPanel();
    }
  });

  // === LOADED ===
  setTimeout(() => showNotification('MEGA EXPLOIT PANEL v9+++++ LOADED!', true), 800);
})();